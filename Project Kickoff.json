{
  "name": "Project Kickoff",
  "nodes": [
    {
      "parameters": {
        "jsCode": "// â”€â”€ SET YOUR BOT TOKEN HERE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\nreturn { botToken: 'YOUR_BOT_TOKEN' };\n// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
      },
      "id": "bot-config",
      "name": "Bot Config",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [100, 300]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "seconds",
              "secondsInterval": 30
            }
          ]
        }
      },
      "id": "schedule-trigger",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [100, 460]
    },
    {
      "parameters": {
        "command": "cat /home/adam/n8n/Project_Kickoff/telegram_offset.txt 2>/dev/null || echo '0'"
      },
      "id": "read-offset",
      "name": "Read Offset",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [300, 460],
      "credentials": {
        "sshPassword": {
          "id": "0EnwcxrRu8Fo75Hq",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://api.telegram.org/bot{{ $('Bot Config').first().json.botToken }}/getUpdates",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "offset",
              "value": "={{ parseInt($('Read Offset').first().json.stdout.trim() || '0') }}"
            },
            {
              "name": "limit",
              "value": "5"
            },
            {
              "name": "timeout",
              "value": "0"
            }
          ]
        },
        "options": {}
      },
      "id": "get-updates",
      "name": "Get Updates",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [500, 460]
    },
    {
      "parameters": {
        "jsCode": "const result = $input.first().json;\nconst updates = result.result || [];\n\nif (!updates.length) {\n  return { hasMessage: false, chatId: null, text: null, newOffset: null };\n}\n\n// Advance offset past all received updates\nconst newOffset = String(updates[updates.length - 1].update_id + 1);\n\n// Find the first text message\nfor (const update of updates) {\n  if (update.message && update.message.text) {\n    return {\n      hasMessage: true,\n      chatId: String(update.message.chat.id),\n      text: update.message.text.trim(),\n      newOffset\n    };\n  }\n}\n\n// Non-text updates â€” still advance offset\nreturn { hasMessage: false, chatId: null, text: null, newOffset };"
      },
      "id": "process-updates",
      "name": "Process Updates",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [700, 460]
    },
    {
      "parameters": {
        "command": "={{ $json.newOffset ? `echo '${$json.newOffset}' > /home/adam/n8n/Project_Kickoff/telegram_offset.txt` : 'echo skip' }}"
      },
      "id": "save-offset",
      "name": "Save Offset",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [900, 460],
      "credentials": {
        "sshPassword": {
          "id": "0EnwcxrRu8Fo75Hq",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "has-message-check",
              "leftValue": "={{ $('Process Updates').first().json.hasMessage }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equal"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "has-message",
      "name": "Has Message",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [1100, 460]
    },
    {
      "parameters": {
        "command": "={{ `cat /home/adam/n8n/Project_Kickoff/state/${$('Process Updates').first().json.chatId}.json 2>/dev/null || echo '{}'` }}"
      },
      "id": "read-state",
      "name": "Read State",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [1300, 460],
      "credentials": {
        "sshPassword": {
          "id": "0EnwcxrRu8Fo75Hq",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const chatId = $('Process Updates').first().json.chatId;\nconst text = $('Process Updates').first().json.text;\n\nlet state = {};\ntry {\n  const stateTxt = ($('Read State').first().json.stdout || '{}').trim();\n  state = JSON.parse(stateTxt || '{}');\n} catch(e) { state = {}; }\n\nconst stage = state.stage || null;\n\n// Brainstorm pending confirmation â€” intercept all messages\nif (stage === 'brainstorm_pending') {\n  if (text === '/confirm' || text.toLowerCase() === 'confirm' || text.toLowerCase() === 'yes') {\n    return {\n      action: 'confirm_brainstorm',\n      chatId,\n      name: state.name,\n      description: state.description,\n      notes: state.notes || ''\n    };\n  }\n  if (text === '/cancel' || text.toLowerCase() === 'cancel' || text.toLowerCase() === 'no') {\n    return { action: 'cancel', chatId };\n  }\n  return {\n    action: 'help',\n    chatId,\n    helpMsg: 'Reply /confirm to kick off this project, or /cancel to discard and start over.'\n  };\n}\n\n// Top-level commands\nif (text.startsWith('/kickoff')) {\n  const content = text.replace('/kickoff', '').trim();\n  if (!content) {\n    return {\n      action: 'help',\n      chatId,\n      helpMsg: 'Include a description after /kickoff.\\n\\nExample:\\n`/kickoff TaskMaster â€” a todo app with user auth and tagging`'\n    };\n  }\n  return { action: 'kickoff', chatId, content };\n}\n\nif (text.startsWith('/brainstorm')) {\n  const vague = text.replace('/brainstorm', '').trim();\n  if (!vague) {\n    return {\n      action: 'help',\n      chatId,\n      helpMsg: 'Include an idea after /brainstorm.\\n\\nExample:\\n`/brainstorm something for tracking my reading habits`'\n    };\n  }\n  return { action: 'brainstorm', chatId, vague };\n}\n\nif (text === '/cancel') {\n  return { action: 'cancel', chatId };\n}\n\nreturn { action: 'help', chatId };"
      },
      "id": "process-message",
      "name": "Process Message",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1500, 460]
    },
    {
      "parameters": {
        "dataType": "string",
        "value1": "={{ $json.action }}",
        "rules": {
          "rules": [
            { "value2": "kickoff", "output": 0 },
            { "value2": "brainstorm", "output": 1 },
            { "value2": "confirm_brainstorm", "output": 2 },
            { "value2": "cancel", "output": 3 }
          ]
        },
        "fallbackOutput": 4
      },
      "id": "route-action",
      "name": "Route Action",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 1,
      "position": [1700, 460]
    },
    {
      "parameters": {
        "jsCode": "const content = $('Process Message').first().json.content;\nconst agentDir = 'Project_Kickoff/agents';\nconst command = `cd /home/adam/n8n && { cat ${agentDir}/input_parser.md; cat <<'AGENTEOF'\\n\\n${content}\\nAGENTEOF\\n} | gemini -p \"\" --yolo`;\nreturn { command };"
      },
      "id": "prepare-parser-cmd",
      "name": "Prepare Parser Command",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1900, 300]
    },
    {
      "parameters": {
        "command": "={{ $json.command }}"
      },
      "id": "agent-input-parser",
      "name": "Agent: Input Parser",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [2100, 300],
      "credentials": {
        "sshPassword": {
          "id": "0EnwcxrRu8Fo75Hq",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "parser-check",
              "leftValue": "={{ $json.stdout }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "if-parser",
      "name": "If: Parser",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [2300, 300]
    },
    {
      "parameters": {
        "jsCode": "const stdout = $json.stdout || '';\nconst chatId = $('Process Message').first().json.chatId;\nlet data;\ntry {\n  const cleaned = stdout.replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim();\n  data = JSON.parse(cleaned);\n} catch(e) {\n  data = { name: 'Project', description: stdout.slice(0, 300), notes: '' };\n}\nreturn {\n  name: data.name || 'Project',\n  description: data.description || '',\n  notes: data.notes || '',\n  chatId\n};"
      },
      "id": "parse-parser-output",
      "name": "Parse Parser Output",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2500, 300]
    },
    {
      "parameters": {
        "jsCode": "const data = $input.first().json;\nreturn {\n  name: data.name || '',\n  description: data.description || '',\n  notes: data.notes || '',\n  chatId: data.chatId\n};"
      },
      "id": "project-data",
      "name": "Project Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2700, 400]
    },
    {
      "parameters": {
        "url": "=https://api.telegram.org/bot{{ $('Bot Config').first().json.botToken }}/sendMessage",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            { "name": "chat_id", "value": "={{ $('Project Data').first().json.chatId }}" },
            { "name": "text", "value": "=ðŸš€ Starting kickoff for *{{ $('Project Data').first().json.name }}*...\n\nðŸ“‹ Step 1/3 â€” Analysing features and requirements..." },
            { "name": "parse_mode", "value": "Markdown" }
          ]
        },
        "options": {}
      },
      "id": "status-starting",
      "name": "Status: Starting",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [2900, 400],
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "const input = $('Project Data').first().json;\nconst agentDir = 'Project_Kickoff/agents';\nconst inputJson = JSON.stringify({ name: input.name, description: input.description, notes: input.notes });\nconst command = `cd /home/adam/n8n && { cat ${agentDir}/product_analyst.md; cat <<'AGENTEOF'\\n\\nInput: ${inputJson}\\nAGENTEOF\\n} | gemini -p \"\" --yolo`;\nreturn { command };"
      },
      "id": "prepare-analyst-cmd",
      "name": "Prepare Analyst Command",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [3100, 400]
    },
    {
      "parameters": {
        "command": "={{ $json.command }}"
      },
      "id": "agent-product-analyst",
      "name": "Agent: Product Analyst",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [3300, 400],
      "credentials": {
        "sshPassword": {
          "id": "0EnwcxrRu8Fo75Hq",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "analyst-check",
              "leftValue": "={{ $json.stdout }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "if-analyst",
      "name": "If: Analyst",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [3500, 400]
    },
    {
      "parameters": {
        "url": "=https://api.telegram.org/bot{{ $('Bot Config').first().json.botToken }}/sendMessage",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            { "name": "chat_id", "value": "={{ $('Project Data').first().json.chatId }}" },
            { "name": "text", "value": "âœ… Feature analysis complete.\n\nâš™ï¸ Step 2/3 â€” Building tech architecture and design system..." }
          ]
        },
        "options": {}
      },
      "id": "status-features-done",
      "name": "Status: Features Done",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [3700, 400],
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "const input = $('Project Data').first().json;\nconst features = $('Agent: Product Analyst').first().json.stdout || '';\nconst agentDir = 'Project_Kickoff/agents';\nconst inputJson = JSON.stringify({ name: input.name, description: input.description, features });\nconst command = `cd /home/adam/n8n && { cat ${agentDir}/tech_architect.md; cat <<'AGENTEOF'\\n\\nInput: ${inputJson}\\nAGENTEOF\\n} | gemini -p \"\" --yolo`;\nreturn { command };"
      },
      "id": "prepare-tech-cmd",
      "name": "Prepare Tech Command",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [3900, 300]
    },
    {
      "parameters": {
        "jsCode": "const input = $('Project Data').first().json;\nconst features = $('Agent: Product Analyst').first().json.stdout || '';\nconst agentDir = 'Project_Kickoff/agents';\nconst inputJson = JSON.stringify({ name: input.name, features });\nconst command = `cd /home/adam/n8n && { cat ${agentDir}/design_director.md; cat <<'AGENTEOF'\\n\\nInput: ${inputJson}\\nAGENTEOF\\n} | gemini -p \"\" --yolo`;\nreturn { command };"
      },
      "id": "prepare-design-cmd",
      "name": "Prepare Design Command",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [3900, 500]
    },
    {
      "parameters": {
        "command": "={{ $json.command }}"
      },
      "id": "agent-tech-architect",
      "name": "Agent: Tech Architect",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [4100, 300],
      "credentials": {
        "sshPassword": {
          "id": "0EnwcxrRu8Fo75Hq",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "command": "={{ $json.command }}"
      },
      "id": "agent-design-director",
      "name": "Agent: Design Director",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [4100, 500],
      "credentials": {
        "sshPassword": {
          "id": "0EnwcxrRu8Fo75Hq",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "tech-check",
              "leftValue": "={{ $json.stdout }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "if-tech",
      "name": "If: Tech",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [4300, 300]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "design-check",
              "leftValue": "={{ $json.stdout }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "if-design",
      "name": "If: Design",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [4300, 500]
    },
    {
      "parameters": {
        "mode": "combine",
        "combinationMode": "mergeByPosition",
        "options": {}
      },
      "id": "merge-results",
      "name": "Merge Results",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2,
      "position": [4500, 400]
    },
    {
      "parameters": {
        "url": "=https://api.telegram.org/bot{{ $('Bot Config').first().json.botToken }}/sendMessage",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            { "name": "chat_id", "value": "={{ $('Project Data').first().json.chatId }}" },
            { "name": "text", "value": "âœ… Architecture and design ready.\n\nðŸ“ Step 3/3 â€” Assembling project files..." }
          ]
        },
        "options": {}
      },
      "id": "status-arch-done",
      "name": "Status: Arch Done",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [4700, 400],
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "const input = $('Project Data').first().json;\nconst features = $('Agent: Product Analyst').first().json.stdout || '';\nconst tech = $('Agent: Tech Architect').first().json.stdout || '';\nconst design = $('Agent: Design Director').first().json.stdout || '';\nconst agentDir = 'Project_Kickoff/agents';\nconst inputJson = JSON.stringify({ name: input.name, description: input.description, features, tech, design });\nconst command = `cd /home/adam/n8n && { cat ${agentDir}/context_assembler.md; cat <<'AGENTEOF'\\n\\nInput: ${inputJson}\\nAGENTEOF\\n} | gemini -p \"\" --yolo`;\nreturn { command };"
      },
      "id": "prepare-assembler-cmd",
      "name": "Prepare Assembler Command",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [4900, 400]
    },
    {
      "parameters": {
        "command": "={{ $json.command }}"
      },
      "id": "agent-context-assembler",
      "name": "Agent: Context Assembler",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [5100, 400],
      "credentials": {
        "sshPassword": {
          "id": "0EnwcxrRu8Fo75Hq",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "assembler-check",
              "leftValue": "={{ $json.stdout }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "if-assembler",
      "name": "If: Assembler",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [5300, 400]
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json.stdout || '';\nconst fileRegex = /## FILE \\d+: ([\\w.-]+)\\n([\\s\\S]*?)(?=\\n## FILE \\d+:|$)/g;\nlet match;\nconst results = [];\nwhile ((match = fileRegex.exec(input)) !== null) {\n  results.push({ fileName: match[1].trim(), content: match[2].trim() });\n}\nif (results.length === 0) {\n  return [{ fileName: 'kickoff_raw.md', content: input }];\n}\nreturn results;"
      },
      "id": "split-output",
      "name": "Split Output",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [5500, 400]
    },
    {
      "parameters": {
        "command": "={{ `PROJECT_DIR=\"/home/adam/projects/${$('Project Data').first().json.name.toLowerCase().replace(/\\\\s+/g, '-')}\"\\nmkdir -p \"$PROJECT_DIR\"\\ncat <<'FILEEOF' > \"$PROJECT_DIR/${$json.fileName}\"\\n${$json.content}\\nFILEEOF\\necho \"Wrote ${$json.fileName} to $PROJECT_DIR\"` }}"
      },
      "id": "write-files",
      "name": "Write Files",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [5700, 400],
      "credentials": {
        "sshPassword": {
          "id": "0EnwcxrRu8Fo75Hq",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://api.telegram.org/bot{{ $('Bot Config').first().json.botToken }}/sendMessage",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            { "name": "chat_id", "value": "={{ $('Project Data').first().json.chatId }}" },
            { "name": "text", "value": "=ðŸ“„ {{ $json.stdout }}" }
          ]
        },
        "options": {}
      },
      "id": "status-file-written",
      "name": "Status: File Written",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [5900, 400],
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "const vague = $('Process Message').first().json.vague;\nconst chatId = $('Process Message').first().json.chatId;\nconst agentDir = 'Project_Kickoff/agents';\nconst command = `cd /home/adam/n8n && { cat ${agentDir}/brainstorm.md; cat <<'AGENTEOF'\\n\\n${vague}\\nAGENTEOF\\n} | gemini -p \"\" --yolo`;\nreturn { command, chatId };"
      },
      "id": "prepare-brainstorm-cmd",
      "name": "Prepare Brainstorm Command",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1900, 580]
    },
    {
      "parameters": {
        "command": "={{ $json.command }}"
      },
      "id": "agent-brainstorm",
      "name": "Agent: Brainstorm",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [2100, 580],
      "credentials": {
        "sshPassword": {
          "id": "0EnwcxrRu8Fo75Hq",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 3
          },
          "conditions": [
            {
              "id": "brainstorm-check",
              "leftValue": "={{ $json.stdout }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "if-brainstorm",
      "name": "If: Brainstorm",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [2300, 580]
    },
    {
      "parameters": {
        "jsCode": "const stdout = $json.stdout || '';\nconst chatId = $('Prepare Brainstorm Command').first().json.chatId;\n\nlet data;\ntry {\n  const cleaned = stdout.replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim();\n  data = JSON.parse(cleaned);\n} catch(e) {\n  return {\n    message: 'âŒ Could not expand on that idea. Please try /brainstorm again.',\n    newStateJson: null,\n    chatId\n  };\n}\n\nconst newStateJson = JSON.stringify({\n  stage: 'brainstorm_pending',\n  name: data.name,\n  description: data.description,\n  notes: data.notes || ''\n});\n\nconst message = `ðŸ’¡ *Here's what I'm thinking:*\\n\\n*${data.name}*\\n\\n${data.summary}\\n\\n_Stack: ${data.notes}_\\n\\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\\nReply /confirm to kick off this project, or /cancel to discard.`;\n\nreturn { message, newStateJson, chatId };"
      },
      "id": "format-brainstorm",
      "name": "Format Brainstorm",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2500, 580]
    },
    {
      "parameters": {
        "command": "={{ `mkdir -p /home/adam/n8n/Project_Kickoff/state && cat <<'STATEEOF' > /home/adam/n8n/Project_Kickoff/state/${$json.chatId}.json\\n${$json.newStateJson}\\nSTATEEOF` }}"
      },
      "id": "save-brainstorm-state",
      "name": "Save Brainstorm State",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [2700, 580],
      "credentials": {
        "sshPassword": {
          "id": "0EnwcxrRu8Fo75Hq",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://api.telegram.org/bot{{ $('Bot Config').first().json.botToken }}/sendMessage",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            { "name": "chat_id", "value": "={{ $('Format Brainstorm').first().json.chatId }}" },
            { "name": "text", "value": "={{ $('Format Brainstorm').first().json.message }}" },
            { "name": "parse_mode", "value": "Markdown" }
          ]
        },
        "options": {}
      },
      "id": "send-brainstorm-results",
      "name": "Send Brainstorm Results",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [2900, 580]
    },
    {
      "parameters": {
        "command": "={{ `rm -f /home/adam/n8n/Project_Kickoff/state/${$json.chatId}.json && echo 'cancelled'` }}"
      },
      "id": "clear-state",
      "name": "Clear State",
      "type": "n8n-nodes-base.ssh",
      "typeVersion": 1,
      "position": [1900, 700],
      "credentials": {
        "sshPassword": {
          "id": "0EnwcxrRu8Fo75Hq",
          "name": "SSH Password account"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://api.telegram.org/bot{{ $('Bot Config').first().json.botToken }}/sendMessage",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            { "name": "chat_id", "value": "={{ $('Process Message').first().json.chatId }}" },
            { "name": "text", "value": "Cancelled. Send /kickoff or /brainstorm when you're ready." }
          ]
        },
        "options": {}
      },
      "id": "send-cancelled",
      "name": "Send Cancelled",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [2100, 700]
    },
    {
      "parameters": {
        "url": "=https://api.telegram.org/bot{{ $('Bot Config').first().json.botToken }}/sendMessage",
        "method": "POST",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            { "name": "chat_id", "value": "={{ $('Process Message').first().json.chatId }}" },
            { "name": "text", "value": "={{ $('Process Message').first().json.helpMsg || 'ðŸ‘‹ *Project Kickoff Bot*\\n\\n`/kickoff [description]` â€” Start a project. Describe what you want to build and I will parse out the details.\\n\\nExample: `/kickoff TaskMaster â€” a todo app with user auth, tags, and due dates`\\n\\n`/brainstorm [vague idea]` â€” Give me a rough concept and I will flesh it out, then ask for your confirmation before kicking off.\\n\\nExample: `/brainstorm something to help me track my reading habits`\\n\\n`/cancel` â€” Cancel the current flow.' }}" },
            { "name": "parse_mode", "value": "Markdown" }
          ]
        },
        "options": {}
      },
      "id": "send-help",
      "name": "Send Help",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1900, 840]
    }
  ],
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Bot Config",
            "type": "main",
            "index": 0
          },
          {
            "node": "Read Offset",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read Offset": {
      "main": [
        [
          {
            "node": "Get Updates",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Updates": {
      "main": [
        [
          {
            "node": "Process Updates",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Updates": {
      "main": [
        [
          {
            "node": "Save Offset",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Offset": {
      "main": [
        [
          {
            "node": "Has Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has Message": {
      "main": [
        [
          {
            "node": "Read State",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read State": {
      "main": [
        [
          {
            "node": "Process Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Process Message": {
      "main": [
        [
          {
            "node": "Route Action",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route Action": {
      "main": [
        [
          {
            "node": "Prepare Parser Command",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare Brainstorm Command",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Project Data",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Clear State",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Help",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Parser Command": {
      "main": [
        [
          {
            "node": "Agent: Input Parser",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agent: Input Parser": {
      "main": [
        [
          {
            "node": "If: Parser",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If: Parser": {
      "main": [
        [
          {
            "node": "Parse Parser Output",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agent: Input Parser",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Parser Output": {
      "main": [
        [
          {
            "node": "Project Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Project Data": {
      "main": [
        [
          {
            "node": "Status: Starting",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Status: Starting": {
      "main": [
        [
          {
            "node": "Prepare Analyst Command",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Analyst Command": {
      "main": [
        [
          {
            "node": "Agent: Product Analyst",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agent: Product Analyst": {
      "main": [
        [
          {
            "node": "If: Analyst",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If: Analyst": {
      "main": [
        [
          {
            "node": "Status: Features Done",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agent: Product Analyst",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Status: Features Done": {
      "main": [
        [
          {
            "node": "Prepare Tech Command",
            "type": "main",
            "index": 0
          },
          {
            "node": "Prepare Design Command",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Tech Command": {
      "main": [
        [
          {
            "node": "Agent: Tech Architect",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Design Command": {
      "main": [
        [
          {
            "node": "Agent: Design Director",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agent: Tech Architect": {
      "main": [
        [
          {
            "node": "If: Tech",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agent: Design Director": {
      "main": [
        [
          {
            "node": "If: Design",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If: Tech": {
      "main": [
        [
          {
            "node": "Merge Results",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agent: Tech Architect",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If: Design": {
      "main": [
        [
          {
            "node": "Merge Results",
            "type": "main",
            "index": 1
          }
        ],
        [
          {
            "node": "Agent: Design Director",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge Results": {
      "main": [
        [
          {
            "node": "Status: Arch Done",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Status: Arch Done": {
      "main": [
        [
          {
            "node": "Prepare Assembler Command",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Assembler Command": {
      "main": [
        [
          {
            "node": "Agent: Context Assembler",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agent: Context Assembler": {
      "main": [
        [
          {
            "node": "If: Assembler",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If: Assembler": {
      "main": [
        [
          {
            "node": "Split Output",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agent: Context Assembler",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Output": {
      "main": [
        [
          {
            "node": "Write Files",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Write Files": {
      "main": [
        [
          {
            "node": "Status: File Written",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Brainstorm Command": {
      "main": [
        [
          {
            "node": "Agent: Brainstorm",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Agent: Brainstorm": {
      "main": [
        [
          {
            "node": "If: Brainstorm",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If: Brainstorm": {
      "main": [
        [
          {
            "node": "Format Brainstorm",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Agent: Brainstorm",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Brainstorm": {
      "main": [
        [
          {
            "node": "Save Brainstorm State",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Brainstorm State": {
      "main": [
        [
          {
            "node": "Send Brainstorm Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Clear State": {
      "main": [
        [
          {
            "node": "Send Cancelled",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "meta": {
    "templateCredsSetupCompleted": false
  },
  "tags": []
}
